<!DOCTYPE html>
<html>
<head>
  <title>zipEntry.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/adm-zip/zipEntry.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>zipEntry.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">var</span> Utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>),
    Headers = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./headers"</span>),
    Constants = Utils.Constants,
    Methods = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./methods"</span>);

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/** object */</span> options, <span class="hljs-regexp">/*Buffer*/</span> input</span>) </span>{
    <span class="hljs-keyword">var</span> _centralHeader = <span class="hljs-keyword">new</span> Headers.EntryHeader(),
        _entryName = Buffer.alloc(<span class="hljs-number">0</span>),
        _comment = Buffer.alloc(<span class="hljs-number">0</span>),
        _isDirectory = <span class="hljs-literal">false</span>,
        uncompressedData = <span class="hljs-literal">null</span>,
        _extra = Buffer.alloc(<span class="hljs-number">0</span>),
        _extralocal = Buffer.alloc(<span class="hljs-number">0</span>),
        _efs = <span class="hljs-literal">true</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>assign options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> opts = options;

    <span class="hljs-keyword">const</span> decoder = <span class="hljs-keyword">typeof</span> opts.decoder === <span class="hljs-string">"object"</span> ? opts.decoder : Utils.decoder;
    _efs = decoder.hasOwnProperty(<span class="hljs-string">"efs"</span>) ? decoder.efs : <span class="hljs-literal">false</span>;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getCompressedDataFromZip</span>(<span class="hljs-params"></span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>if (!input || !Buffer.isBuffer(input)) {</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!input || !(input <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Uint8Array</span>)) {
            <span class="hljs-keyword">return</span> Buffer.alloc(<span class="hljs-number">0</span>);
        }
        _extralocal = _centralHeader.loadLocalHeaderFromBinary(input);
        <span class="hljs-keyword">return</span> input.slice(_centralHeader.realDataOffset, _centralHeader.realDataOffset + _centralHeader.compressedSize);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">crc32OK</span>(<span class="hljs-params">data</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>if bit 3 (0x08) of the general-purpose flags field is set, then the CRC-32 and file sizes are not known when the local header is written</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!_centralHeader.flags_desc) {
            <span class="hljs-keyword">if</span> (Utils.crc32(data) !== _centralHeader.localHeader.crc) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">const</span> descriptor = {};
            <span class="hljs-keyword">const</span> dataEndOffset = _centralHeader.realDataOffset + _centralHeader.compressedSize;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>no descriptor after compressed data, instead new local header</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (input.readUInt32LE(dataEndOffset) == Constants.LOCSIG || input.readUInt32LE(dataEndOffset) == Constants.CENSIG) {
                <span class="hljs-keyword">throw</span> Utils.Errors.DESCRIPTOR_NOT_EXIST();
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>get decriptor data</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (input.readUInt32LE(dataEndOffset) == Constants.EXTSIG) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>descriptor with signature</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                descriptor.crc = input.readUInt32LE(dataEndOffset + Constants.EXTCRC);
                descriptor.compressedSize = input.readUInt32LE(dataEndOffset + Constants.EXTSIZ);
                descriptor.size = input.readUInt32LE(dataEndOffset + Constants.EXTLEN);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (input.readUInt16LE(dataEndOffset + <span class="hljs-number">12</span>) === <span class="hljs-number">0x4b50</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>descriptor without signature (we check is new header starting where we expect)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                descriptor.crc = input.readUInt32LE(dataEndOffset + Constants.EXTCRC - <span class="hljs-number">4</span>);
                descriptor.compressedSize = input.readUInt32LE(dataEndOffset + Constants.EXTSIZ - <span class="hljs-number">4</span>);
                descriptor.size = input.readUInt32LE(dataEndOffset + Constants.EXTLEN - <span class="hljs-number">4</span>);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> Utils.Errors.DESCRIPTOR_UNKNOWN();
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>check data integrity</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (descriptor.compressedSize !== _centralHeader.compressedSize || descriptor.size !== _centralHeader.size || descriptor.crc !== _centralHeader.crc) {
                <span class="hljs-keyword">throw</span> Utils.Errors.DESCRIPTOR_FAULTY();
            }
            <span class="hljs-keyword">if</span> (Utils.crc32(data) !== descriptor.crc) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>@TODO: zip64 bit descriptor fields
if bit 3 is set and any value in local header &quot;zip64 Extended information&quot; extra field are set 0 (place holder)
then 64-bit descriptor format is used instead of 32-bit
central header - &quot;zip64 Extended information&quot; extra field should store real values and not place holders</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">decompress</span>(<span class="hljs-params"><span class="hljs-regexp">/*Boolean*/</span> async, <span class="hljs-regexp">/*Function*/</span> callback, <span class="hljs-regexp">/*String, Buffer*/</span> pass</span>) </span>{
        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> <span class="hljs-keyword">async</span> === <span class="hljs-string">"string"</span>) {
            pass = <span class="hljs-keyword">async</span>;
            <span class="hljs-keyword">async</span> = <span class="hljs-keyword">void</span> <span class="hljs-number">0</span>;
        }
        <span class="hljs-keyword">if</span> (_isDirectory) {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) {
                callback(Buffer.alloc(<span class="hljs-number">0</span>), Utils.Errors.DIRECTORY_CONTENT_ERROR()); <span class="hljs-comment">//si added error.</span>
            }
            <span class="hljs-keyword">return</span> Buffer.alloc(<span class="hljs-number">0</span>);
        }

        <span class="hljs-keyword">var</span> compressedData = getCompressedDataFromZip();

        <span class="hljs-keyword">if</span> (compressedData.length === <span class="hljs-number">0</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>File is empty, nothing to decompress.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(compressedData);
            <span class="hljs-keyword">return</span> compressedData;
        }

        <span class="hljs-keyword">if</span> (_centralHeader.encrypted) {
            <span class="hljs-keyword">if</span> (<span class="hljs-string">"string"</span> !== <span class="hljs-keyword">typeof</span> pass &amp;&amp; !Buffer.isBuffer(pass)) {
                <span class="hljs-keyword">throw</span> Utils.Errors.INVALID_PASS_PARAM();
            }
            compressedData = Methods.ZipCrypto.decrypt(compressedData, _centralHeader, pass);
        }

        <span class="hljs-keyword">var</span> data = Buffer.alloc(_centralHeader.size);

        <span class="hljs-keyword">switch</span> (_centralHeader.method) {
            <span class="hljs-keyword">case</span> Utils.Constants.STORED:
                compressedData.copy(data);
                <span class="hljs-keyword">if</span> (!crc32OK(data)) {
                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(data, Utils.Errors.BAD_CRC()); <span class="hljs-comment">//si added error</span>
                    <span class="hljs-keyword">throw</span> Utils.Errors.BAD_CRC();
                } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>si added otherwise did not seem to return data.</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(data);
                    <span class="hljs-keyword">return</span> data;
                }
            <span class="hljs-keyword">case</span> Utils.Constants.DEFLATED:
                <span class="hljs-keyword">var</span> inflater = <span class="hljs-keyword">new</span> Methods.Inflater(compressedData, _centralHeader.size);
                <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">async</span>) {
                    <span class="hljs-keyword">const</span> result = inflater.inflate(data);
                    result.copy(data, <span class="hljs-number">0</span>);
                    <span class="hljs-keyword">if</span> (!crc32OK(data)) {
                        <span class="hljs-keyword">throw</span> Utils.Errors.BAD_CRC(<span class="hljs-string">`"<span class="hljs-subst">${decoder.decode(_entryName)}</span>"`</span>);
                    }
                    <span class="hljs-keyword">return</span> data;
                } <span class="hljs-keyword">else</span> {
                    inflater.inflateAsync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">result</span>) </span>{
                        result.copy(result, <span class="hljs-number">0</span>);
                        <span class="hljs-keyword">if</span> (callback) {
                            <span class="hljs-keyword">if</span> (!crc32OK(result)) {
                                callback(result, Utils.Errors.BAD_CRC()); <span class="hljs-comment">//si added error</span>
                            } <span class="hljs-keyword">else</span> {
                                callback(result);
                            }
                        }
                    });
                }
                <span class="hljs-keyword">break</span>;
            <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(Buffer.alloc(<span class="hljs-number">0</span>), Utils.Errors.UNKNOWN_METHOD());
                <span class="hljs-keyword">throw</span> Utils.Errors.UNKNOWN_METHOD();
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">compress</span>(<span class="hljs-params"><span class="hljs-regexp">/*Boolean*/</span> async, <span class="hljs-regexp">/*Function*/</span> callback</span>) </span>{
        <span class="hljs-keyword">if</span> ((!uncompressedData || !uncompressedData.length) &amp;&amp; Buffer.isBuffer(input)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>no data set or the data wasn't changed to require recompression</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(getCompressedDataFromZip());
            <span class="hljs-keyword">return</span> getCompressedDataFromZip();
        }

        <span class="hljs-keyword">if</span> (uncompressedData.length &amp;&amp; !_isDirectory) {
            <span class="hljs-keyword">var</span> compressedData;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>Local file header</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">switch</span> (_centralHeader.method) {
                <span class="hljs-keyword">case</span> Utils.Constants.STORED:
                    _centralHeader.compressedSize = _centralHeader.size;

                    compressedData = Buffer.alloc(uncompressedData.length);
                    uncompressedData.copy(compressedData);

                    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) callback(compressedData);
                    <span class="hljs-keyword">return</span> compressedData;
                <span class="hljs-keyword">default</span>:
                <span class="hljs-keyword">case</span> Utils.Constants.DEFLATED:
                    <span class="hljs-keyword">var</span> deflater = <span class="hljs-keyword">new</span> Methods.Deflater(uncompressedData);
                    <span class="hljs-keyword">if</span> (!<span class="hljs-keyword">async</span>) {
                        <span class="hljs-keyword">var</span> deflated = deflater.deflate();
                        _centralHeader.compressedSize = deflated.length;
                        <span class="hljs-keyword">return</span> deflated;
                    } <span class="hljs-keyword">else</span> {
                        deflater.deflateAsync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data</span>) </span>{
                            compressedData = Buffer.alloc(data.length);
                            _centralHeader.compressedSize = data.length;
                            data.copy(compressedData);
                            callback &amp;&amp; callback(compressedData);
                        });
                    }
                    deflater = <span class="hljs-literal">null</span>;
                    <span class="hljs-keyword">break</span>;
            }
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-keyword">async</span> &amp;&amp; callback) {
            callback(Buffer.alloc(<span class="hljs-number">0</span>));
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">return</span> Buffer.alloc(<span class="hljs-number">0</span>);
        }
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">readUInt64LE</span>(<span class="hljs-params">buffer, offset</span>) </span>{
        <span class="hljs-keyword">return</span> (buffer.readUInt32LE(offset + <span class="hljs-number">4</span>) &lt;&lt; <span class="hljs-number">4</span>) + buffer.readUInt32LE(offset);
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseExtra</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">try</span> {
            <span class="hljs-keyword">var</span> offset = <span class="hljs-number">0</span>;
            <span class="hljs-keyword">var</span> signature, size, part;
            <span class="hljs-keyword">while</span> (offset + <span class="hljs-number">4</span> &lt; data.length) {
                signature = data.readUInt16LE(offset);
                offset += <span class="hljs-number">2</span>;
                size = data.readUInt16LE(offset);
                offset += <span class="hljs-number">2</span>;
                part = data.slice(offset, offset + size);
                offset += size;
                <span class="hljs-keyword">if</span> (Constants.ID_ZIP64 === signature) {
                    parseZip64ExtendedInformation(part);
                }
            }
        } <span class="hljs-keyword">catch</span> (error) {
            <span class="hljs-keyword">throw</span> Utils.Errors.EXTRA_FIELD_PARSE_ERROR();
        }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>Override header field values with values from the ZIP64 extra field</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">parseZip64ExtendedInformation</span>(<span class="hljs-params">data</span>) </span>{
        <span class="hljs-keyword">var</span> size, compressedSize, offset, diskNumStart;

        <span class="hljs-keyword">if</span> (data.length &gt;= Constants.EF_ZIP64_SCOMP) {
            size = readUInt64LE(data, Constants.EF_ZIP64_SUNCOMP);
            <span class="hljs-keyword">if</span> (_centralHeader.size === Constants.EF_ZIP64_OR_32) {
                _centralHeader.size = size;
            }
        }
        <span class="hljs-keyword">if</span> (data.length &gt;= Constants.EF_ZIP64_RHO) {
            compressedSize = readUInt64LE(data, Constants.EF_ZIP64_SCOMP);
            <span class="hljs-keyword">if</span> (_centralHeader.compressedSize === Constants.EF_ZIP64_OR_32) {
                _centralHeader.compressedSize = compressedSize;
            }
        }
        <span class="hljs-keyword">if</span> (data.length &gt;= Constants.EF_ZIP64_DSN) {
            offset = readUInt64LE(data, Constants.EF_ZIP64_RHO);
            <span class="hljs-keyword">if</span> (_centralHeader.offset === Constants.EF_ZIP64_OR_32) {
                _centralHeader.offset = offset;
            }
        }
        <span class="hljs-keyword">if</span> (data.length &gt;= Constants.EF_ZIP64_DSN + <span class="hljs-number">4</span>) {
            diskNumStart = data.readUInt32LE(Constants.EF_ZIP64_DSN);
            <span class="hljs-keyword">if</span> (_centralHeader.diskNumStart === Constants.EF_ZIP64_OR_16) {
                _centralHeader.diskNumStart = diskNumStart;
            }
        }
    }

    <span class="hljs-keyword">return</span> {
        <span class="hljs-keyword">get</span> entryName() {
            <span class="hljs-keyword">return</span> decoder.decode(_entryName);
        },
        <span class="hljs-keyword">get</span> rawEntryName() {
            <span class="hljs-keyword">return</span> _entryName;
        },
        <span class="hljs-keyword">set</span> entryName(val) {
            _entryName = Utils.toBuffer(val, decoder.encode);
            <span class="hljs-keyword">var</span> lastChar = _entryName[_entryName.length - <span class="hljs-number">1</span>];
            _isDirectory = lastChar === <span class="hljs-number">47</span> || lastChar === <span class="hljs-number">92</span>;
            _centralHeader.fileNameLength = _entryName.length;
        },

        <span class="hljs-keyword">get</span> efs() {
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> _efs === <span class="hljs-string">"function"</span>) {
                <span class="hljs-keyword">return</span> _efs(<span class="hljs-keyword">this</span>.entryName);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> _efs;
            }
        },

        <span class="hljs-keyword">get</span> extra() {
            <span class="hljs-keyword">return</span> _extra;
        },
        <span class="hljs-keyword">set</span> extra(val) {
            _extra = val;
            _centralHeader.extraLength = val.length;
            parseExtra(val);
        },

        <span class="hljs-keyword">get</span> comment() {
            <span class="hljs-keyword">return</span> decoder.decode(_comment);
        },
        <span class="hljs-keyword">set</span> comment(val) {
            _comment = Utils.toBuffer(val, decoder.encode);
            _centralHeader.commentLength = _comment.length;
            <span class="hljs-keyword">if</span> (_comment.length &gt; <span class="hljs-number">0xffff</span>) <span class="hljs-keyword">throw</span> Utils.Errors.COMMENT_TOO_LONG();
        },

        <span class="hljs-keyword">get</span> name() {
            <span class="hljs-keyword">var</span> n = decoder.decode(_entryName);
            <span class="hljs-keyword">return</span> _isDirectory
                ? n
                      .substr(n.length - <span class="hljs-number">1</span>)
                      .split(<span class="hljs-string">"/"</span>)
                      .pop()
                : n.split(<span class="hljs-string">"/"</span>).pop();
        },
        <span class="hljs-keyword">get</span> isDirectory() {
            <span class="hljs-keyword">return</span> _isDirectory;
        },

        <span class="hljs-attr">getCompressedData</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> compress(<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>);
        },

        <span class="hljs-attr">getCompressedDataAsync</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/*Function*/</span> callback</span>) </span>{
            compress(<span class="hljs-literal">true</span>, callback);
        },

        <span class="hljs-attr">setData</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">value</span>) </span>{
            uncompressedData = Utils.toBuffer(value, Utils.decoder.encode);
            <span class="hljs-keyword">if</span> (!_isDirectory &amp;&amp; uncompressedData.length) {
                _centralHeader.size = uncompressedData.length;
                _centralHeader.method = Utils.Constants.DEFLATED;
                _centralHeader.crc = Utils.crc32(value);
                _centralHeader.changed = <span class="hljs-literal">true</span>;
            } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>folders and blank files should be stored</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                _centralHeader.method = Utils.Constants.STORED;
            }
        },

        <span class="hljs-attr">getData</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pass</span>) </span>{
            <span class="hljs-keyword">if</span> (_centralHeader.changed) {
                <span class="hljs-keyword">return</span> uncompressedData;
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">return</span> decompress(<span class="hljs-literal">false</span>, <span class="hljs-literal">null</span>, pass);
            }
        },

        <span class="hljs-attr">getDataAsync</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/*Function*/</span> callback, pass</span>) </span>{
            <span class="hljs-keyword">if</span> (_centralHeader.changed) {
                callback(uncompressedData);
            } <span class="hljs-keyword">else</span> {
                decompress(<span class="hljs-literal">true</span>, callback, pass);
            }
        },

        <span class="hljs-keyword">set</span> attr(attr) {
            _centralHeader.attr = attr;
        },
        <span class="hljs-keyword">get</span> attr() {
            <span class="hljs-keyword">return</span> _centralHeader.attr;
        },

        <span class="hljs-keyword">set</span> header(/*Buffer*/ data) {
            _centralHeader.loadFromBinary(data);
        },

        <span class="hljs-keyword">get</span> header() {
            <span class="hljs-keyword">return</span> _centralHeader;
        },

        <span class="hljs-attr">packCentralHeader</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            _centralHeader.flags_efs = <span class="hljs-keyword">this</span>.efs;
            _centralHeader.extraLength = _extra.length;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<ol>
<li>create header (buffer)</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">var</span> header = _centralHeader.centralHeaderToBinary();
            <span class="hljs-keyword">var</span> addpos = Utils.Constants.CENHDR;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<ol start="2">
<li>add file name</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _entryName.copy(header, addpos);
            addpos += _entryName.length;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<ol start="3">
<li>add extra data</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _extra.copy(header, addpos);
            addpos += _centralHeader.extraLength;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<ol start="4">
<li>add file comment</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _comment.copy(header, addpos);
            <span class="hljs-keyword">return</span> header;
        },

        <span class="hljs-attr">packLocalHeader</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">let</span> addpos = <span class="hljs-number">0</span>;
            _centralHeader.flags_efs = <span class="hljs-keyword">this</span>.efs;
            _centralHeader.extraLocalLength = _extralocal.length;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<ol>
<li>construct local header Buffer</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> localHeaderBuf = _centralHeader.localHeaderToBinary();
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<ol start="2">
<li>localHeader - crate header buffer</li>
</ol>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> localHeader = Buffer.alloc(localHeaderBuf.length + _entryName.length + _centralHeader.extraLocalLength);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<p>2.1 add localheader</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            localHeaderBuf.copy(localHeader, addpos);
            addpos += localHeaderBuf.length;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<p>2.2 add file name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _entryName.copy(localHeader, addpos);
            addpos += _entryName.length;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<p>2.3 add extra field</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _extralocal.copy(localHeader, addpos);
            addpos += _extralocal.length;

            <span class="hljs-keyword">return</span> localHeader;
        },

        <span class="hljs-attr">toJSON</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">const</span> bytes = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">nr</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-string">"&lt;"</span> + ((nr &amp;&amp; nr.length + <span class="hljs-string">" bytes buffer"</span>) || <span class="hljs-string">"null"</span>) + <span class="hljs-string">"&gt;"</span>;
            };

            <span class="hljs-keyword">return</span> {
                <span class="hljs-attr">entryName</span>: <span class="hljs-keyword">this</span>.entryName,
                <span class="hljs-attr">name</span>: <span class="hljs-keyword">this</span>.name,
                <span class="hljs-attr">comment</span>: <span class="hljs-keyword">this</span>.comment,
                <span class="hljs-attr">isDirectory</span>: <span class="hljs-keyword">this</span>.isDirectory,
                <span class="hljs-attr">header</span>: _centralHeader.toJSON(),
                <span class="hljs-attr">compressedData</span>: bytes(input),
                <span class="hljs-attr">data</span>: bytes(uncompressedData)
            };
        },

        <span class="hljs-attr">toString</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-built_in">JSON</span>.stringify(<span class="hljs-keyword">this</span>.toJSON(), <span class="hljs-literal">null</span>, <span class="hljs-string">"\t"</span>);
        }
    };
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
