<!DOCTYPE html>
<html>
<head>
  <title>adm-zip.js</title>
  <meta http-equiv="content-type" content="text/html; charset=UTF-8">
  <link rel="stylesheet" media="all" href="../../doc-style.css" />
  <script src="../../doc-filelist.js"></script>
  <script>
    var relativeDir = "../../";
    var thisFile = "node_modules/adm-zip/adm-zip.js";
    var defaultSidebar = true;
  </script>
  <script src="../../doc-script.js"></script>

</head>
<body>
  <div id="sidebar_wrapper">
    <div id="sidebar_switch">
      <span class="tree">Files</span>
      <span class="headings">Headings</span>
    </div>
    <div id="tree"></div>
    <div id="headings">

    </div>
  </div>
  <div id="sidebar-toggle"></div>
  <div id="container">
    <div class="background highlight"></div>
<table cellpadding="0" cellspacing="0">
  <tbody>
    
      <tr>
        <td class="docs">
          <h1>adm-zip.js</h1>
        </td>
        <td class="code highlight"></td>
      </tr>
    
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-1" id="section-1"></a>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript"><span class="hljs-keyword">const</span> Utils = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./util"</span>);
<span class="hljs-keyword">const</span> pth = <span class="hljs-built_in">require</span>(<span class="hljs-string">"path"</span>);
<span class="hljs-keyword">const</span> ZipEntry = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./zipEntry"</span>);
<span class="hljs-keyword">const</span> ZipFile = <span class="hljs-built_in">require</span>(<span class="hljs-string">"./zipFile"</span>);

<span class="hljs-keyword">const</span> get_Bool = <span class="hljs-function">(<span class="hljs-params">...val</span>) =&gt;</span> Utils.findLast(val, (c) =&gt; <span class="hljs-keyword">typeof</span> c === <span class="hljs-string">"boolean"</span>);
<span class="hljs-keyword">const</span> get_Str = <span class="hljs-function">(<span class="hljs-params">...val</span>) =&gt;</span> Utils.findLast(val, (c) =&gt; <span class="hljs-keyword">typeof</span> c === <span class="hljs-string">"string"</span>);
<span class="hljs-keyword">const</span> get_Fun = <span class="hljs-function">(<span class="hljs-params">...val</span>) =&gt;</span> Utils.findLast(val, (c) =&gt; <span class="hljs-keyword">typeof</span> c === <span class="hljs-string">"function"</span>);

<span class="hljs-keyword">const</span> defaultOptions = {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-2" id="section-2"></a>
</div>
<p>option &quot;noSort&quot; : if true it disables files sorting</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    noSort: <span class="hljs-literal">false</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-3" id="section-3"></a>
</div>
<p>read entries during load (initial loading may be slower)</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    readEntries: <span class="hljs-literal">false</span>,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-4" id="section-4"></a>
</div>
<p>default method is none</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    method: Utils.Constants.NONE,
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-5" id="section-5"></a>
</div>
<p>file system</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    fs: <span class="hljs-literal">null</span>
};

<span class="hljs-built_in">module</span>.exports = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/**String*/</span> input, <span class="hljs-regexp">/** object */</span> options</span>) </span>{
    <span class="hljs-keyword">let</span> inBuffer = <span class="hljs-literal">null</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-6" id="section-6"></a>
</div>
<p>create object based default options, allowing them to be overwritten</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> opts = <span class="hljs-built_in">Object</span>.assign(<span class="hljs-built_in">Object</span>.create(<span class="hljs-literal">null</span>), defaultOptions);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-7" id="section-7"></a>
</div>
<p>test input variable</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (input &amp;&amp; <span class="hljs-string">"object"</span> === <span class="hljs-keyword">typeof</span> input) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-8" id="section-8"></a>
</div>
<p>if value is not buffer we accept it to be object with options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (!(input <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">Uint8Array</span>)) {
            <span class="hljs-built_in">Object</span>.assign(opts, input);
            input = opts.input ? opts.input : <span class="hljs-literal">undefined</span>;
            <span class="hljs-keyword">if</span> (opts.input) <span class="hljs-keyword">delete</span> opts.input;
        }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-9" id="section-9"></a>
</div>
<p>if input is buffer</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (Buffer.isBuffer(input)) {
            inBuffer = input;
            opts.method = Utils.Constants.BUFFER;
            input = <span class="hljs-literal">undefined</span>;
        }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-10" id="section-10"></a>
</div>
<p>assign options</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-built_in">Object</span>.assign(opts, options);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-11" id="section-11"></a>
</div>
<p>instanciate utils filesystem</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> filetools = <span class="hljs-keyword">new</span> Utils(opts);

    <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> opts.decoder !== <span class="hljs-string">"object"</span> || <span class="hljs-keyword">typeof</span> opts.decoder.encode !== <span class="hljs-string">"function"</span> || <span class="hljs-keyword">typeof</span> opts.decoder.decode !== <span class="hljs-string">"function"</span>) {
        opts.decoder = Utils.decoder;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-12" id="section-12"></a>
</div>
<p>if input is file name we retrieve its content</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">if</span> (input &amp;&amp; <span class="hljs-string">"string"</span> === <span class="hljs-keyword">typeof</span> input) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-13" id="section-13"></a>
</div>
<p>load zip file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">if</span> (filetools.fs.existsSync(input)) {
            opts.method = Utils.Constants.FILE;
            opts.filename = input;
            inBuffer = filetools.fs.readFileSync(input);
        } <span class="hljs-keyword">else</span> {
            <span class="hljs-keyword">throw</span> Utils.Errors.INVALID_FILENAME();
        }
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-14" id="section-14"></a>
</div>
<p>create variable</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> _zip = <span class="hljs-keyword">new</span> ZipFile(inBuffer, opts);

    <span class="hljs-keyword">const</span> { canonical, sanitize, zipnamefix } = Utils;

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">getEntry</span>(<span class="hljs-params"><span class="hljs-regexp">/**Object*/</span> entry</span>) </span>{
        <span class="hljs-keyword">if</span> (entry &amp;&amp; _zip) {
            <span class="hljs-keyword">var</span> item;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-15" id="section-15"></a>
</div>
<p>If entry was given as a file name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> entry === <span class="hljs-string">"string"</span>) item = _zip.getEntry(pth.posix.normalize(entry));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-16" id="section-16"></a>
</div>
<p>if entry was given as a ZipEntry object</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> entry === <span class="hljs-string">"object"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> entry.entryName !== <span class="hljs-string">"undefined"</span> &amp;&amp; <span class="hljs-keyword">typeof</span> entry.header !== <span class="hljs-string">"undefined"</span>) item = _zip.getEntry(entry.entryName);

            <span class="hljs-keyword">if</span> (item) {
                <span class="hljs-keyword">return</span> item;
            }
        }
        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">fixPath</span>(<span class="hljs-params">zipPath</span>) </span>{
        <span class="hljs-keyword">const</span> { join, normalize, sep } = pth.posix;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-17" id="section-17"></a>
</div>
<p>convert windows file separators and normalize</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">        <span class="hljs-keyword">return</span> join(<span class="hljs-string">"."</span>, normalize(sep + zipPath.split(<span class="hljs-string">"\\"</span>).join(sep) + sep));
    }

    <span class="hljs-function"><span class="hljs-keyword">function</span> <span class="hljs-title">filenameFilter</span>(<span class="hljs-params">filterfn</span>) </span>{
        <span class="hljs-keyword">if</span> (filterfn <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-18" id="section-18"></a>
</div>
<p>if filter is RegExp wrap it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rx</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filename</span>) </span>{
                    <span class="hljs-keyword">return</span> rx.test(filename);
                };
            })(filterfn);
        } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"function"</span> !== <span class="hljs-keyword">typeof</span> filterfn) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-19" id="section-19"></a>
</div>
<p>if filter is not function we will replace it</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> <span class="hljs-literal">true</span>;
        }
        <span class="hljs-keyword">return</span> filterfn;
    }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-20" id="section-20"></a>
</div>
<p>keep last character on folders</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">    <span class="hljs-keyword">const</span> relativePath = <span class="hljs-function">(<span class="hljs-params">local, entry</span>) =&gt;</span> {
        <span class="hljs-keyword">let</span> lastChar = entry.slice(<span class="hljs-number">-1</span>);
        lastChar = lastChar === filetools.sep ? filetools.sep : <span class="hljs-string">""</span>;
        <span class="hljs-keyword">return</span> pth.relative(local, entry) + lastChar;
    };

    <span class="hljs-keyword">return</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-21" id="section-21"></a>
</div>
<div class="dox">
<div class="summary">
<p>Extracts the given entry from the archive and returns the content as a Buffer object</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
<span>ZipEntry object or String with the full path of the entry
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[pass]</span>
<span class="dox_type">Buffer</span>
<span class="dox_type">string</span>
<span><ul>
<li>password</li>
</ul>
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>Buffer or Null in case of error
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        readFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, pass</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">return</span> (item &amp;&amp; item.getData(pass)) || <span class="hljs-literal">null</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-22" id="section-22"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns how many child elements has on entry (directories) on files it is always 0</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
<span>ZipEntry object or String with the full path of the entry
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        childCount: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
            <span class="hljs-keyword">const</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                <span class="hljs-keyword">return</span> _zip.getChildCount(item);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-23" id="section-23"></a>
</div>
<div class="dox">
<div class="summary">
<p>Asynchronous readFile</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
<span>ZipEntry object or String with the full path of the entry
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">callback</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>Buffer or Null in case of error
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        readFileAsync: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, callback</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                item.getDataAsync(callback);
            } <span class="hljs-keyword">else</span> {
                callback(<span class="hljs-literal">null</span>, <span class="hljs-string">"getEntry failed for:"</span> + entry);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-24" id="section-24"></a>
</div>
<div class="dox">
<div class="summary">
<p>Extracts the given entry from the archive and returns the content as plain text in the given encoding</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
<span><ul>
<li>ZipEntry object or String with the full path of the entry</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">encoding</span>
<span class="dox_type">string</span>
<span><ul>
<li>Optional. If no encoding is specified utf8 is used</li>
</ul>
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>String
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        readAsText: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, encoding</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                <span class="hljs-keyword">var</span> data = item.getData();
                <span class="hljs-keyword">if</span> (data &amp;&amp; data.length) {
                    <span class="hljs-keyword">return</span> data.toString(encoding || <span class="hljs-string">"utf8"</span>);
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-25" id="section-25"></a>
</div>
<div class="dox">
<div class="summary">
<p>Asynchronous readAsText</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
<span>ZipEntry object or String with the full path of the entry
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">callback</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[encoding]</span>
<span class="dox_type">string</span>
<span><ul>
<li>Optional. If no encoding is specified utf8 is used</li>
</ul>
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>String
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        readAsTextAsync: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, callback, encoding</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                item.getDataAsync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">data, err</span>) </span>{
                    <span class="hljs-keyword">if</span> (err) {
                        callback(data, err);
                        <span class="hljs-keyword">return</span>;
                    }

                    <span class="hljs-keyword">if</span> (data &amp;&amp; data.length) {
                        callback(data.toString(encoding || <span class="hljs-string">"utf8"</span>));
                    } <span class="hljs-keyword">else</span> {
                        callback(<span class="hljs-string">""</span>);
                    }
                });
            } <span class="hljs-keyword">else</span> {
                callback(<span class="hljs-string">""</span>);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-26" id="section-26"></a>
</div>
<div class="dox">
<div class="summary">
<p>Remove the entry from the file or the entry and all it's nested directories and files if the given entry is a directory</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        deleteFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, withsubfolders = true</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-27" id="section-27"></a>
</div>
<p>@TODO: test deleteFile</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                _zip.deleteFile(item.entryName, withsubfolders);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-28" id="section-28"></a>
</div>
<div class="dox">
<div class="summary">
<p>Remove the entry from the file or directory without affecting any nested entries</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        deleteEntry: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-29" id="section-29"></a>
</div>
<p>@TODO: test deleteEntry</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                _zip.deleteEntry(item.entryName);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-30" id="section-30"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a comment to the zip. The zip must be rewritten after adding the comment.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">comment</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addZipComment: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">comment</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-31" id="section-31"></a>
</div>
<p>@TODO: test addZipComment</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            _zip.comment = comment;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-32" id="section-32"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns the zip comment</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>String
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        getZipComment: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _zip.comment || <span class="hljs-string">""</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-33" id="section-33"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a comment to a specified zipEntry. The zip must be rewritten after adding the comment
The comment cannot exceed 65535 characters in length</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">comment</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addZipEntryComment: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, comment</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                item.comment = comment;
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-34" id="section-34"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns the comment of the specified entry</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>String
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        getZipEntryComment: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                <span class="hljs-keyword">return</span> item.comment || <span class="hljs-string">""</span>;
            }
            <span class="hljs-keyword">return</span> <span class="hljs-string">""</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-35" id="section-35"></a>
</div>
<div class="dox">
<div class="summary">
<p>Updates the content of an existing entry inside the archive. The zip must be rewritten after updating the content</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">ZipEntry</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">content</span>
<span class="dox_type">Buffer</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        updateFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, content</span>) </span>{
            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (item) {
                item.setData(content);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-36" id="section-36"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a file from the disk to the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">localPath</span>
<span class="dox_type">string</span>
<span>File to add to zip
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[zipPath]</span>
<span class="dox_type">string</span>
<span>Optional path inside the zip
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[zipName]</span>
<span class="dox_type">string</span>
<span>Optional name for the file
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[comment]</span>
<span class="dox_type">string</span>
<span>Optional file comment
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">localPath, zipPath, zipName, comment</span>) </span>{
            <span class="hljs-keyword">if</span> (filetools.fs.existsSync(localPath)) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-37" id="section-37"></a>
</div>
<p>fix ZipPath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                zipPath = zipPath ? fixPath(zipPath) : <span class="hljs-string">""</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-38" id="section-38"></a>
</div>
<p>p - local file name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> p = pth.win32.basename(pth.win32.normalize(localPath));

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-39" id="section-39"></a>
</div>
<p>add file name into zippath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                zipPath += zipName ? zipName : p;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-40" id="section-40"></a>
</div>
<p>read file attributes</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> _attr = filetools.fs.statSync(localPath);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-41" id="section-41"></a>
</div>
<p>get file content</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> data = _attr.isFile() ? filetools.fs.readFileSync(localPath) : Buffer.alloc(<span class="hljs-number">0</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-42" id="section-42"></a>
</div>
<p>if folder</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (_attr.isDirectory()) zipPath += filetools.sep;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-43" id="section-43"></a>
</div>
<p>add file into zip file</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">this</span>.addFile(zipPath, data, comment, _attr);
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> Utils.Errors.FILE_NOT_FOUND(localPath);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-44" id="section-44"></a>
</div>
<div class="dox">
<div class="summary">
<p>Callback for showing if everything was done.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">err</span>
<span class="dox_type">Error</span>
<span><ul>
<li>Error object</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">done</span>
<span class="dox_type">boolean</span>
<span><ul>
<li>was request fully completed</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-45" id="section-45"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a file from the disk to the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">object</span>
<span class="dox_type">string</span>
<span><ul>
<li>options object, if it is string it us used as localPath.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options.localPath</span>
<span class="dox_type">string</span>
<span><ul>
<li>Local path to the file.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.comment]</span>
<span class="dox_type">string</span>
<span><ul>
<li>Optional file comment.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.zipPath]</span>
<span class="dox_type">string</span>
<span><ul>
<li>Optional path inside the zip</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.zipName]</span>
<span class="dox_type">string</span>
<span><ul>
<li>Optional name for the file</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">doneCallback</span>
<span><ul>
<li>The callback that handles the response.</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFileAsync: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options, callback</span>) </span>{
            options = <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">"object"</span> ? options : { <span class="hljs-attr">localPath</span>: options };
            <span class="hljs-keyword">const</span> localPath = pth.resolve(options.localPath);
            <span class="hljs-keyword">const</span> { comment } = options;
            <span class="hljs-keyword">let</span> { zipPath, zipName } = options;
            <span class="hljs-keyword">const</span> self = <span class="hljs-keyword">this</span>;

            filetools.fs.stat(localPath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, stats</span>) </span>{
                <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(err, <span class="hljs-literal">false</span>);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-46" id="section-46"></a>
</div>
<p>fix ZipPath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                zipPath = zipPath ? fixPath(zipPath) : <span class="hljs-string">""</span>;
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-47" id="section-47"></a>
</div>
<p>p - local file name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> p = pth.win32.basename(pth.win32.normalize(localPath));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-48" id="section-48"></a>
</div>
<p>add file name into zippath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                zipPath += zipName ? zipName : p;

                <span class="hljs-keyword">if</span> (stats.isFile()) {
                    filetools.fs.readFile(localPath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, data</span>) </span>{
                        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(err, <span class="hljs-literal">false</span>);
                        self.addFile(zipPath, data, comment, stats);
                        <span class="hljs-keyword">return</span> setImmediate(callback, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">true</span>);
                    });
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (stats.isDirectory()) {
                    zipPath += filetools.sep;
                    self.addFile(zipPath, Buffer.alloc(<span class="hljs-number">0</span>), comment, stats);
                    <span class="hljs-keyword">return</span> setImmediate(callback, <span class="hljs-literal">undefined</span>, <span class="hljs-literal">true</span>);
                }
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-49" id="section-49"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a local directory and all its nested files and directories to the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">localPath</span>
<span class="dox_type">string</span>
<span><ul>
<li>local path to the folder</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[zipPath]</span>
<span class="dox_type">string</span>
<span><ul>
<li>optional path inside zip</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[filter]</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">function</span>
<span><ul>
<li>optional RegExp or Function if files match will be included.</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFolder: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">localPath, zipPath, filter</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-50" id="section-50"></a>
</div>
<p>Prepare filter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            filter = filenameFilter(filter);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-51" id="section-51"></a>
</div>
<p>fix ZipPath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            zipPath = zipPath ? fixPath(zipPath) : <span class="hljs-string">""</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-52" id="section-52"></a>
</div>
<p>normalize the path first</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            localPath = pth.normalize(localPath);

            <span class="hljs-keyword">if</span> (filetools.fs.existsSync(localPath)) {
                <span class="hljs-keyword">const</span> items = filetools.findFiles(localPath);
                <span class="hljs-keyword">const</span> self = <span class="hljs-keyword">this</span>;

                <span class="hljs-keyword">if</span> (items.length) {
                    <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> filepath <span class="hljs-keyword">of</span> items) {
                        <span class="hljs-keyword">const</span> p = pth.join(zipPath, relativePath(localPath, filepath));
                        <span class="hljs-keyword">if</span> (filter(p)) {
                            self.addLocalFile(filepath, pth.dirname(p));
                        }
                    }
                }
            } <span class="hljs-keyword">else</span> {
                <span class="hljs-keyword">throw</span> Utils.Errors.FILE_NOT_FOUND(localPath);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-53" id="section-53"></a>
</div>
<div class="dox">
<div class="summary">
<p>Asynchronous addLocalFolder</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">localPath</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">callback</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[zipPath]</span>
<span class="dox_type">string</span>
<span>optional path inside zip
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[filter]</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">function</span>
<span>optional RegExp or Function if files match will               be included.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFolderAsync: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">localPath, callback, zipPath, filter</span>) </span>{
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-54" id="section-54"></a>
</div>
<p>Prepare filter</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            filter = filenameFilter(filter);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-55" id="section-55"></a>
</div>
<p>fix ZipPath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            zipPath = zipPath ? fixPath(zipPath) : <span class="hljs-string">""</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-56" id="section-56"></a>
</div>
<p>normalize the path first</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            localPath = pth.normalize(localPath);

            <span class="hljs-keyword">var</span> self = <span class="hljs-keyword">this</span>;
            filetools.fs.open(localPath, <span class="hljs-string">"r"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">"ENOENT"</span>) {
                    callback(<span class="hljs-literal">undefined</span>, Utils.Errors.FILE_NOT_FOUND(localPath));
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err) {
                    callback(<span class="hljs-literal">undefined</span>, err);
                } <span class="hljs-keyword">else</span> {
                    <span class="hljs-keyword">var</span> items = filetools.findFiles(localPath);
                    <span class="hljs-keyword">var</span> i = <span class="hljs-number">-1</span>;

                    <span class="hljs-keyword">var</span> next = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                        i += <span class="hljs-number">1</span>;
                        <span class="hljs-keyword">if</span> (i &lt; items.length) {
                            <span class="hljs-keyword">var</span> filepath = items[i];
                            <span class="hljs-keyword">var</span> p = relativePath(localPath, filepath).split(<span class="hljs-string">"\\"</span>).join(<span class="hljs-string">"/"</span>); <span class="hljs-comment">//windows fix</span>
                            p = p
                                .normalize(<span class="hljs-string">"NFD"</span>)
                                .replace(<span class="hljs-regexp">/[\u0300-\u036f]/g</span>, <span class="hljs-string">""</span>)
                                .replace(<span class="hljs-regexp">/[^\x20-\x7E]/g</span>, <span class="hljs-string">""</span>); <span class="hljs-comment">// accent fix</span>
                            <span class="hljs-keyword">if</span> (filter(p)) {
                                filetools.fs.stat(filepath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">er0, stats</span>) </span>{
                                    <span class="hljs-keyword">if</span> (er0) callback(<span class="hljs-literal">undefined</span>, er0);
                                    <span class="hljs-keyword">if</span> (stats.isFile()) {
                                        filetools.fs.readFile(filepath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">er1, data</span>) </span>{
                                            <span class="hljs-keyword">if</span> (er1) {
                                                callback(<span class="hljs-literal">undefined</span>, er1);
                                            } <span class="hljs-keyword">else</span> {
                                                self.addFile(zipPath + p, data, <span class="hljs-string">""</span>, stats);
                                                next();
                                            }
                                        });
                                    } <span class="hljs-keyword">else</span> {
                                        self.addFile(zipPath + p + <span class="hljs-string">"/"</span>, Buffer.alloc(<span class="hljs-number">0</span>), <span class="hljs-string">""</span>, stats);
                                        next();
                                    }
                                });
                            } <span class="hljs-keyword">else</span> {
                                process.nextTick(<span class="hljs-function"><span class="hljs-params">()</span> =&gt;</span> {
                                    next();
                                });
                            }
                        } <span class="hljs-keyword">else</span> {
                            callback(<span class="hljs-literal">true</span>, <span class="hljs-literal">undefined</span>);
                        }
                    };

                    next();
                }
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-57" id="section-57"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a local directory and all its nested files and directories to the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options</span>
<span class="dox_type">object</span>
<span class="dox_type">string</span>
<span><ul>
<li>options object, if it is string it us used as localPath.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">options.localPath</span>
<span class="dox_type">string</span>
<span><ul>
<li>Local path to the folder.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.zipPath]</span>
<span class="dox_type">string</span>
<span><ul>
<li>optional path inside zip.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.filter]</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">function</span>
<span><ul>
<li>optional RegExp or Function if files match will be included.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[options.namefix]</span>
<span class="dox_type">function</span>
<span class="dox_type">string</span>
<span><ul>
<li>optional function to help fix filename</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">doneCallback</span>
<span><ul>
<li>The callback that handles the response.</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFolderAsync2: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">options, callback</span>) </span>{
            <span class="hljs-keyword">const</span> self = <span class="hljs-keyword">this</span>;
            options = <span class="hljs-keyword">typeof</span> options === <span class="hljs-string">"object"</span> ? options : { <span class="hljs-attr">localPath</span>: options };
            localPath = pth.resolve(fixPath(options.localPath));
            <span class="hljs-keyword">let</span> { zipPath, filter, namefix } = options;

            <span class="hljs-keyword">if</span> (filter <span class="hljs-keyword">instanceof</span> <span class="hljs-built_in">RegExp</span>) {
                filter = (<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">rx</span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">filename</span>) </span>{
                        <span class="hljs-keyword">return</span> rx.test(filename);
                    };
                })(filter);
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"function"</span> !== <span class="hljs-keyword">typeof</span> filter) {
                filter = <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
                };
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-58" id="section-58"></a>
</div>
<p>fix ZipPath</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            zipPath = zipPath ? fixPath(zipPath) : <span class="hljs-string">""</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-59" id="section-59"></a>
</div>
<p>Check Namefix function</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (namefix == <span class="hljs-string">"latin1"</span>) {
                namefix = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span>
                    str
                        .normalize(<span class="hljs-string">"NFD"</span>)
                        .replace(<span class="hljs-regexp">/[\u0300-\u036f]/g</span>, <span class="hljs-string">""</span>)
                        .replace(<span class="hljs-regexp">/[^\x20-\x7E]/g</span>, <span class="hljs-string">""</span>); <span class="hljs-comment">// accent fix (latin1 characers only)</span>
            }

            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> namefix !== <span class="hljs-string">"function"</span>) namefix = <span class="hljs-function">(<span class="hljs-params">str</span>) =&gt;</span> str;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-60" id="section-60"></a>
</div>
<p>internal, create relative path + fix the name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> relPathFix = <span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> pth.join(zipPath, namefix(relativePath(localPath, entry)));
            <span class="hljs-keyword">const</span> fileNameFix = <span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> pth.win32.basename(pth.win32.normalize(namefix(entry)));

            filetools.fs.open(localPath, <span class="hljs-string">"r"</span>, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                <span class="hljs-keyword">if</span> (err &amp;&amp; err.code === <span class="hljs-string">"ENOENT"</span>) {
                    callback(<span class="hljs-literal">undefined</span>, Utils.Errors.FILE_NOT_FOUND(localPath));
                } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (err) {
                    callback(<span class="hljs-literal">undefined</span>, err);
                } <span class="hljs-keyword">else</span> {
                    filetools.findFilesAsync(localPath, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, fileEntries</span>) </span>{
                        <span class="hljs-keyword">if</span> (err) <span class="hljs-keyword">return</span> callback(err);
                        fileEntries = fileEntries.filter(<span class="hljs-function">(<span class="hljs-params">dir</span>) =&gt;</span> filter(relPathFix(dir)));
                        <span class="hljs-keyword">if</span> (!fileEntries.length) callback(<span class="hljs-literal">undefined</span>, <span class="hljs-literal">false</span>);

                        setImmediate(
                            fileEntries.reverse().reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">next, entry</span>) </span>{
                                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err, done</span>) </span>{
                                    <span class="hljs-keyword">if</span> (err || done === <span class="hljs-literal">false</span>) <span class="hljs-keyword">return</span> setImmediate(next, err, <span class="hljs-literal">false</span>);

                                    self.addLocalFileAsync(
                                        {
                                            <span class="hljs-attr">localPath</span>: entry,
                                            <span class="hljs-attr">zipPath</span>: pth.dirname(relPathFix(entry)),
                                            <span class="hljs-attr">zipName</span>: fileNameFix(entry)
                                        },
                                        next
                                    );
                                };
                            }, callback)
                        );
                    });
                }
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-61" id="section-61"></a>
</div>
<div class="dox">
<div class="summary">
<p>Adds a local directory and all its nested files and directories to the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">localPath</span>
<span class="dox_type">string</span>
<span><ul>
<li>path where files will be extracted</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">props</span>
<span class="dox_type">object</span>
<span><ul>
<li>optional properties</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props.zipPath]</span>
<span class="dox_type">string</span>
<span><ul>
<li>optional path inside zip</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props.filter]</span>
<span class="dox_type">RegExp</span>
<span class="dox_type">function</span>
<span><ul>
<li>optional RegExp or Function if files match will be included.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props.namefix]</span>
<span class="dox_type">function</span>
<span class="dox_type">string</span>
<span><ul>
<li>optional function to help fix filename</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addLocalFolderPromise: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">localPath, props</span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                <span class="hljs-keyword">this</span>.addLocalFolderAsync2(<span class="hljs-built_in">Object</span>.assign({ localPath }, props), (err, done) =&gt; {
                    <span class="hljs-keyword">if</span> (err) reject(err);
                    <span class="hljs-keyword">if</span> (done) resolve(<span class="hljs-keyword">this</span>);
                });
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-62" id="section-62"></a>
</div>
<div class="dox">
<div class="summary">
<p>Allows you to create a entry (file or directory) in the zip file.
If you want to create a directory the entryName must end in / and a null buffer should be provided.
Comment and attributes are optional</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entryName</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">content</span>
<span class="dox_type">Buffer</span>
<span class="dox_type">string</span>
<span><ul>
<li>file content as buffer or utf8 coded string</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[comment]</span>
<span class="dox_type">string</span>
<span><ul>
<li>file comment</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[attr]</span>
<span class="dox_type">number</span>
<span class="dox_type">object</span>
<span><ul>
<li>number as unix file permissions, object as filesystem Stats object</li>
</ul>
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        addFile: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entryName, content, comment, attr</span>) </span>{
            entryName = zipnamefix(entryName);
            <span class="hljs-keyword">let</span> entry = getEntry(entryName);
            <span class="hljs-keyword">const</span> update = entry != <span class="hljs-literal">null</span>;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-63" id="section-63"></a>
</div>
<p>prepare new entry</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (!update) {
                entry = <span class="hljs-keyword">new</span> ZipEntry(opts);
                entry.entryName = entryName;
            }
            entry.comment = comment || <span class="hljs-string">""</span>;

            <span class="hljs-keyword">const</span> isStat = <span class="hljs-string">"object"</span> === <span class="hljs-keyword">typeof</span> attr &amp;&amp; attr <span class="hljs-keyword">instanceof</span> filetools.fs.Stats;

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-64" id="section-64"></a>
</div>
<p>last modification time from file stats</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">if</span> (isStat) {
                entry.header.time = attr.mtime;
            }

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-65" id="section-65"></a>
</div>
<p>Set file attribute</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">var</span> fileattr = entry.isDirectory ? <span class="hljs-number">0x10</span> : <span class="hljs-number">0</span>; <span class="hljs-comment">// (MS-DOS directory flag)</span>

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-66" id="section-66"></a>
</div>
<p>extended attributes field for Unix
set file type either S_IFDIR / S_IFREG</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">let</span> unix = entry.isDirectory ? <span class="hljs-number">0x4000</span> : <span class="hljs-number">0x8000</span>;

            <span class="hljs-keyword">if</span> (isStat) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-67" id="section-67"></a>
</div>
<p>File attributes from file stats</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                unix |= <span class="hljs-number">0xfff</span> &amp; attr.mode;
            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (<span class="hljs-string">"number"</span> === <span class="hljs-keyword">typeof</span> attr) {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-68" id="section-68"></a>
</div>
<p>attr from given attr values</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                unix |= <span class="hljs-number">0xfff</span> &amp; attr;
            } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-69" id="section-69"></a>
</div>
<p>Default values:</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                unix |= entry.isDirectory ? <span class="hljs-number">0o755</span> : <span class="hljs-number">0o644</span>; <span class="hljs-comment">// permissions (drwxr-xr-x) or (-r-wr--r--)</span>
            }

            fileattr = (fileattr | (unix &lt;&lt; <span class="hljs-number">16</span>)) &gt;&gt;&gt; <span class="hljs-number">0</span>; <span class="hljs-comment">// add attributes</span>

            entry.attr = fileattr;

            entry.setData(content);
            <span class="hljs-keyword">if</span> (!update) _zip.setEntry(entry);

            <span class="hljs-keyword">return</span> entry;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-70" id="section-70"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns an array of ZipEntry objects representing the files and folders inside the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[password]</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        getEntries: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">password</span>) </span>{
            _zip.password = password;
            <span class="hljs-keyword">return</span> _zip ? _zip.entries : [];
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-71" id="section-71"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns a ZipEntry object representing the file or folder specified by <code>name</code>.</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">name</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>ZipEntry
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        getEntry: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/**String*/</span> name</span>) </span>{
            <span class="hljs-keyword">return</span> getEntry(name);
        },

        <span class="hljs-attr">getEntryCount</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> _zip.getEntryCount();
        },

        <span class="hljs-attr">forEach</span>: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">callback</span>) </span>{
            <span class="hljs-keyword">return</span> _zip.forEach(callback);
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-72" id="section-72"></a>
</div>
<div class="dox">
<div class="summary">
<p>Extracts the given entry to the given targetPath
If the entry is a directory inside the archive, the entire directory and it's subdirectories will be extracted</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">entry</span>
<span class="dox_type">string</span>
<span class="dox_type">ZipEntry</span>
<span><ul>
<li>ZipEntry object or String with the full path of the entry</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">targetPath</span>
<span class="dox_type">string</span>
<span><ul>
<li>Target folder where to write the file</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[maintainEntryPath=true]</span>
<span class="dox_type">boolean</span>
<span><ul>
<li>If maintainEntryPath is true and the entry is inside a folder, the entry folder will be created in targetPath as well. Default is TRUE</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[overwrite=false]</span>
<span class="dox_type">boolean</span>
<span><ul>
<li>If the file already exists at the target path, the file will be overwriten if this is true.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[keepOriginalPermission=false]</span>
<span class="dox_type">boolean</span>
<span><ul>
<li>The file will be set as the permission from the entry if this is true.</li>
</ul>
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[outFileName]</span>
<span class="dox_type">string</span>
<span><ul>
<li>String If set will override the filename of the extracted file (Only works if the entry is a file)</li>
</ul>
</span>
</div>
<div class="dox_tag_title">Returns</div>
<div class="dox_tag_detail">
<span class="dox_tag_name"></span>
<span>Boolean
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        extractEntryTo: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry, targetPath, maintainEntryPath, overwrite, keepOriginalPermission, outFileName</span>) </span>{
            overwrite = get_Bool(<span class="hljs-literal">false</span>, overwrite);
            keepOriginalPermission = get_Bool(<span class="hljs-literal">false</span>, keepOriginalPermission);
            maintainEntryPath = get_Bool(<span class="hljs-literal">true</span>, maintainEntryPath);
            outFileName = get_Str(keepOriginalPermission, outFileName);

            <span class="hljs-keyword">var</span> item = getEntry(entry);
            <span class="hljs-keyword">if</span> (!item) {
                <span class="hljs-keyword">throw</span> Utils.Errors.NO_ENTRY();
            }

            <span class="hljs-keyword">var</span> entryName = canonical(item.entryName);

            <span class="hljs-keyword">var</span> target = sanitize(targetPath, outFileName &amp;&amp; !item.isDirectory ? outFileName : maintainEntryPath ? entryName : pth.basename(entryName));

            <span class="hljs-keyword">if</span> (item.isDirectory) {
                <span class="hljs-keyword">var</span> children = _zip.getEntryChildren(item);
                children.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">child</span>) </span>{
                    <span class="hljs-keyword">if</span> (child.isDirectory) <span class="hljs-keyword">return</span>;
                    <span class="hljs-keyword">var</span> content = child.getData();
                    <span class="hljs-keyword">if</span> (!content) {
                        <span class="hljs-keyword">throw</span> Utils.Errors.CANT_EXTRACT_FILE();
                    }
                    <span class="hljs-keyword">var</span> name = canonical(child.entryName);
                    <span class="hljs-keyword">var</span> childName = sanitize(targetPath, maintainEntryPath ? name : pth.basename(name));
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-73" id="section-73"></a>
</div>
<p>The reverse operation for attr depend on method addFile()</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    <span class="hljs-keyword">const</span> fileAttr = keepOriginalPermission ? child.header.fileAttr : <span class="hljs-literal">undefined</span>;
                    filetools.writeFileTo(childName, content, overwrite, fileAttr);
                });
                <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
            }

            <span class="hljs-keyword">var</span> content = item.getData(_zip.password);
            <span class="hljs-keyword">if</span> (!content) <span class="hljs-keyword">throw</span> Utils.Errors.CANT_EXTRACT_FILE();

            <span class="hljs-keyword">if</span> (filetools.fs.existsSync(target) &amp;&amp; !overwrite) {
                <span class="hljs-keyword">throw</span> Utils.Errors.CANT_OVERRIDE();
            }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-74" id="section-74"></a>
</div>
<p>The reverse operation for attr depend on method addFile()</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> fileAttr = keepOriginalPermission ? entry.header.fileAttr : <span class="hljs-literal">undefined</span>;
            filetools.writeFileTo(target, content, overwrite, fileAttr);

            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-75" id="section-75"></a>
</div>
<div class="dox">
<div class="summary">
<p>Test the archive</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[pass]</span>
<span class="dox_type">string</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        test: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">pass</span>) </span>{
            <span class="hljs-keyword">if</span> (!_zip) {
                <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
            }

            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">var</span> entry <span class="hljs-keyword">in</span> _zip.entries) {
                <span class="hljs-keyword">try</span> {
                    <span class="hljs-keyword">if</span> (entry.isDirectory) {
                        <span class="hljs-keyword">continue</span>;
                    }
                    <span class="hljs-keyword">var</span> content = _zip.entries[entry].getData(pass);
                    <span class="hljs-keyword">if</span> (!content) {
                        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                    }
                } <span class="hljs-keyword">catch</span> (err) {
                    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;
                }
            }
            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-76" id="section-76"></a>
</div>
<div class="dox">
<div class="summary">
<p>Extracts the entire archive to the given location</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">targetPath</span>
<span class="dox_type">string</span>
<span>Target location
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[overwrite=false]</span>
<span class="dox_type">boolean</span>
<span>If the file already exists at the target path, the file will be overwriten if this is true.                  Default is FALSE
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[keepOriginalPermission=false]</span>
<span class="dox_type">boolean</span>
<span>The file will be set as the permission from the entry if this is true.                  Default is FALSE
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[pass]</span>
<span class="dox_type">string</span>
<span class="dox_type">Buffer</span>
<span>password
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        extractAllTo: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">targetPath, overwrite, keepOriginalPermission, pass</span>) </span>{
            keepOriginalPermission = get_Bool(<span class="hljs-literal">false</span>, keepOriginalPermission);
            pass = get_Str(keepOriginalPermission, pass);
            overwrite = get_Bool(<span class="hljs-literal">false</span>, overwrite);
            <span class="hljs-keyword">if</span> (!_zip) <span class="hljs-keyword">throw</span> Utils.Errors.NO_ZIP();

            _zip.entries.forEach(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">entry</span>) </span>{
                <span class="hljs-keyword">var</span> entryName = sanitize(targetPath, canonical(entry.entryName));
                <span class="hljs-keyword">if</span> (entry.isDirectory) {
                    filetools.makeDir(entryName);
                    <span class="hljs-keyword">return</span>;
                }
                <span class="hljs-keyword">var</span> content = entry.getData(pass);
                <span class="hljs-keyword">if</span> (!content) {
                    <span class="hljs-keyword">throw</span> Utils.Errors.CANT_EXTRACT_FILE();
                }
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-77" id="section-77"></a>
</div>
<p>The reverse operation for attr depend on method addFile()</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> fileAttr = keepOriginalPermission ? entry.header.fileAttr : <span class="hljs-literal">undefined</span>;
                filetools.writeFileTo(entryName, content, overwrite, fileAttr);
                <span class="hljs-keyword">try</span> {
                    filetools.fs.utimesSync(entryName, entry.header.time, entry.header.time);
                } <span class="hljs-keyword">catch</span> (err) {
                    <span class="hljs-keyword">throw</span> Utils.Errors.CANT_EXTRACT_FILE();
                }
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-78" id="section-78"></a>
</div>
<div class="dox">
<div class="summary">
<p>Asynchronous extractAllTo</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">targetPath</span>
<span class="dox_type">string</span>
<span>Target location
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[overwrite=false]</span>
<span class="dox_type">boolean</span>
<span>If the file already exists at the target path, the file will be overwriten if this is true.                  Default is FALSE
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[keepOriginalPermission=false]</span>
<span class="dox_type">boolean</span>
<span>The file will be set as the permission from the entry if this is true.                  Default is FALSE
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">function</span>
<span>The callback will be executed when all entries are extracted successfully or any error is thrown.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        extractAllToAsync: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">targetPath, overwrite, keepOriginalPermission, callback</span>) </span>{
            callback = get_Fun(overwrite, keepOriginalPermission, callback);
            keepOriginalPermission = get_Bool(<span class="hljs-literal">false</span>, keepOriginalPermission);
            overwrite = get_Bool(<span class="hljs-literal">false</span>, overwrite);
            <span class="hljs-keyword">if</span> (!callback) {
                <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                    <span class="hljs-keyword">this</span>.extractAllToAsync(targetPath, overwrite, keepOriginalPermission, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                        <span class="hljs-keyword">if</span> (err) {
                            reject(err);
                        } <span class="hljs-keyword">else</span> {
                            resolve(<span class="hljs-keyword">this</span>);
                        }
                    });
                });
            }
            <span class="hljs-keyword">if</span> (!_zip) {
                callback(Utils.Errors.NO_ZIP());
                <span class="hljs-keyword">return</span>;
            }

            targetPath = pth.resolve(targetPath);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-79" id="section-79"></a>
</div>
<p>convert entryName to</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> getPath = <span class="hljs-function">(<span class="hljs-params">entry</span>) =&gt;</span> sanitize(targetPath, pth.normalize(canonical(entry.entryName)));
            <span class="hljs-keyword">const</span> getError = <span class="hljs-function">(<span class="hljs-params">msg, file</span>) =&gt;</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(msg + <span class="hljs-string">': "'</span> + file + <span class="hljs-string">'"'</span>);

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-80" id="section-80"></a>
</div>
<p>separate directories from files</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">const</span> dirEntries = [];
            <span class="hljs-keyword">const</span> fileEntries = [];
            _zip.entries.forEach(<span class="hljs-function">(<span class="hljs-params">e</span>) =&gt;</span> {
                <span class="hljs-keyword">if</span> (e.isDirectory) {
                    dirEntries.push(e);
                } <span class="hljs-keyword">else</span> {
                    fileEntries.push(e);
                }
            });

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-81" id="section-81"></a>
</div>
<p>Create directory entries first synchronously
this prevents race condition and assures folders are there before writing files</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">            <span class="hljs-keyword">for</span> (<span class="hljs-keyword">const</span> entry <span class="hljs-keyword">of</span> dirEntries) {
                <span class="hljs-keyword">const</span> dirPath = getPath(entry);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-82" id="section-82"></a>
</div>
<p>The reverse operation for attr depend on method addFile()</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">const</span> dirAttr = keepOriginalPermission ? entry.header.fileAttr : <span class="hljs-literal">undefined</span>;
                <span class="hljs-keyword">try</span> {
                    filetools.makeDir(dirPath);
                    <span class="hljs-keyword">if</span> (dirAttr) filetools.fs.chmodSync(dirPath, dirAttr);
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-83" id="section-83"></a>
</div>
<p>in unix timestamp will change if files are later added to folder, but still</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                    filetools.fs.utimesSync(dirPath, entry.header.time, entry.header.time);
                } <span class="hljs-keyword">catch</span> (er) {
                    callback(getError(<span class="hljs-string">"Unable to create folder"</span>, dirPath));
                }
            }

            fileEntries.reverse().reduce(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">next, entry</span>) </span>{
                <span class="hljs-keyword">return</span> <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err</span>) </span>{
                    <span class="hljs-keyword">if</span> (err) {
                        next(err);
                    } <span class="hljs-keyword">else</span> {
                        <span class="hljs-keyword">const</span> entryName = pth.normalize(canonical(entry.entryName));
                        <span class="hljs-keyword">const</span> filePath = sanitize(targetPath, entryName);
                        entry.getDataAsync(<span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">content, err_1</span>) </span>{
                            <span class="hljs-keyword">if</span> (err_1) {
                                next(err_1);
                            } <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!content) {
                                next(Utils.Errors.CANT_EXTRACT_FILE());
                            } <span class="hljs-keyword">else</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-84" id="section-84"></a>
</div>
<p>The reverse operation for attr depend on method addFile()</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                                <span class="hljs-keyword">const</span> fileAttr = keepOriginalPermission ? entry.header.fileAttr : <span class="hljs-literal">undefined</span>;
                                filetools.writeFileToAsync(filePath, content, overwrite, fileAttr, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">succ</span>) </span>{
                                    <span class="hljs-keyword">if</span> (!succ) {
                                        next(getError(<span class="hljs-string">"Unable to write file"</span>, filePath));
                                    }
                                    filetools.fs.utimes(filePath, entry.header.time, entry.header.time, <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">err_2</span>) </span>{
                                        <span class="hljs-keyword">if</span> (err_2) {
                                            next(getError(<span class="hljs-string">"Unable to set times"</span>, filePath));
                                        } <span class="hljs-keyword">else</span> {
                                            next();
                                        }
                                    });
                                });
                            }
                        });
                    }
                };
            }, callback)();
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-85" id="section-85"></a>
</div>
<div class="dox">
<div class="summary">
<p>Writes the newly created zip file to disk at the specified location or if a zip was opened and no <code>targetFileName</code> is provided, it will overwrite the opened zip</p>
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">targetFileName</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">callback</span>
<span class="dox_type">function</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        writeZip: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">targetFileName, callback</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">arguments</span>.length === <span class="hljs-number">1</span>) {
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> targetFileName === <span class="hljs-string">"function"</span>) {
                    callback = targetFileName;
                    targetFileName = <span class="hljs-string">""</span>;
                }
            }

            <span class="hljs-keyword">if</span> (!targetFileName &amp;&amp; opts.filename) {
                targetFileName = opts.filename;
            }
            <span class="hljs-keyword">if</span> (!targetFileName) <span class="hljs-keyword">return</span>;

            <span class="hljs-keyword">var</span> zipData = _zip.compressToBuffer();
            <span class="hljs-keyword">if</span> (zipData) {
                <span class="hljs-keyword">var</span> ok = filetools.writeFileTo(targetFileName, zipData, <span class="hljs-literal">true</span>);
                <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> callback === <span class="hljs-string">"function"</span>) callback(!ok ? <span class="hljs-keyword">new</span> <span class="hljs-built_in">Error</span>(<span class="hljs-string">"failed"</span>) : <span class="hljs-literal">null</span>, <span class="hljs-string">""</span>);
            }
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-86" id="section-86"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
<div class="dox_tag_title">Params</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">targetFileName</span>
<span class="dox_type">string</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props]</span>
<span class="dox_type">object</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props.overwrite=true]</span>
<span class="dox_type">boolean</span>
<span>If the file already exists at the target path, the file will be overwriten if this is true.
</span>
</div>
<div class="dox_tag_detail">
<span class="dox_tag_name">[props.perm]</span>
<span class="dox_type">boolean</span>
<span>The file will be set as the permission from the entry if this is true.
</span>
</div>
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        writeZipPromise: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"><span class="hljs-regexp">/**String*/</span> targetFileName, <span class="hljs-regexp">/* object */</span> props</span>) </span>{
            <span class="hljs-keyword">const</span> { overwrite, perm } = <span class="hljs-built_in">Object</span>.assign({ <span class="hljs-attr">overwrite</span>: <span class="hljs-literal">true</span> }, props);

            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-87" id="section-87"></a>
</div>
<p>find file name</p>

        </td>
        <td class="code highlight">
          <pre class="javascript">                <span class="hljs-keyword">if</span> (!targetFileName &amp;&amp; opts.filename) targetFileName = opts.filename;
                <span class="hljs-keyword">if</span> (!targetFileName) reject(<span class="hljs-string">"ADM-ZIP: ZIP File Name Missing"</span>);

                <span class="hljs-keyword">this</span>.toBufferPromise().then(<span class="hljs-function">(<span class="hljs-params">zipData</span>) =&gt;</span> {
                    <span class="hljs-keyword">const</span> ret = <span class="hljs-function">(<span class="hljs-params">done</span>) =&gt;</span> (done ? resolve(done) : reject(<span class="hljs-string">"ADM-ZIP: Wasn't able to write zip file"</span>));
                    filetools.writeFileToAsync(targetFileName, zipData, overwrite, perm, ret);
                }, reject);
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-88" id="section-88"></a>
</div>
<div class="dox">
<div class="summary">
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        toBufferPromise: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params"></span>) </span>{
            <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-built_in">Promise</span>(<span class="hljs-function">(<span class="hljs-params">resolve, reject</span>) =&gt;</span> {
                _zip.toAsyncBuffer(resolve, reject);
            });
        },

</pre>
        </td>
      </tr>
    
      <tr>
        <td class="docs">
          <div class="pilwrap">
  <a class="pilcrow" href="#section-89" id="section-89"></a>
</div>
<div class="dox">
<div class="summary">
<p>Returns the content of the entire zip file as a Buffer object</p>
</div>
<div class="body">
</div>
<div class="details">
</div>
</div>

        </td>
        <td class="code highlight">
          <pre class="javascript">        toBuffer: <span class="hljs-function"><span class="hljs-keyword">function</span> (<span class="hljs-params">onSuccess, onFail, onItemStart, onItemEnd</span>) </span>{
            <span class="hljs-keyword">if</span> (<span class="hljs-keyword">typeof</span> onSuccess === <span class="hljs-string">"function"</span>) {
                _zip.toAsyncBuffer(onSuccess, onFail, onItemStart, onItemEnd);
                <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;
            }
            <span class="hljs-keyword">return</span> _zip.compressToBuffer();
        }
    };
};

</pre>
        </td>
      </tr>
    
  </tbody>
</table>

  </div>
</body>
</html>
